<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL Query Optimization Interface</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/default.min.css">
    <!-- 引入 sql-formatter 库 -->
    <script src="https://cdn.jsdelivr.net/npm/sql-formatter@4.0.2/dist/sql-formatter.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/sql.min.js"></script>
</head>
<body class="h-screen bg-gray-100 flex text-sm">
    <!-- Sidebar -->
    <div id="sidebar" class="bg-white shadow-lg transition-all duration-300 w-0 overflow-hidden">
        <div class="p-2">
            <h2 class="text-base font-semibold mb-2">Connections</h2>
            <ul class="text-xs">
                <li class="mb-1">
                    <div class="flex items-center">
                        <i class="fas fa-database w-3 h-3 mr-1"></i>
                        <span>Database 1</span>
                    </div>
                </li>
                <li class="mb-1">
                    <div class="flex items-center ml-3">
                        <i class="fas fa-table w-3 h-3 mr-1"></i>
                        <span>Table 1</span>
                    </div>
                </li>
                <li class="mb-1">
                    <div class="flex items-center ml-3">
                        <i class="fas fa-table w-3 h-3 mr-1"></i>
                        <span>Table 2</span>
                    </div>
                </li>
            </ul>
        </div>
    </div>

    <!-- Main content -->
    <div class="flex-1 flex flex-col">
        <!-- Top bar -->
        <div class="bg-white shadow-sm p-2 flex items-center justify-between">
            <div class="flex items-center">
                <button id="toggleSidebar" class="mr-2">
                    <i class="fas fa-chevron-right w-4 h-4"></i>
                </button>
                <h1 class="text-lg font-bold">SQL 助手</h1>
            </div>
            <div class="flex items-center space-x-2">
                
                <button id="loginButton" class="bg-gray-500 text-white px-2 py-1 rounded text-xs hover:bg-gray-600 flex items-center">
                    <i class="fas fa-user w-3 h-3 mr-1"></i>
                    <span>Login</span>
                </button>
            </div>
        </div>

        <!-- Query editor -->
        <div class="flex-1 p-2">
            <textarea id="queryEditor" class="w-full h-full p-2 border border-gray-300 rounded resize-none focus:outline-none focus:ring-1 focus:ring-blue-500 text-sm" placeholder="Enter your SQL query here..."></textarea>
        </div>

        <!-- Query results -->
        <div class="flex-1 p-2 flex flex-col">
    <div class="flex justify-between items-center mb-2">
        <h2 class="text-base font-semibold">Query Results</h2>
        <div class="flex items-center space-x-2">
            <button id="executeButton" class="bg-blue-500 text-white px-2 py-1 rounded text-xs hover:bg-blue-600 flex items-center">
                <i class="fas fa-play w-3 h-3 mr-1"></i> Execute
            </button>
            <button id="optimizeButton" class="bg-green-500 text-white px-2 py-1 rounded text-xs hover:bg-green-600 flex items-center">
                <i class="fas fa-bolt w-3 h-3 mr-1"></i> Optimize
            </button>
            <button id="formatButton" class="bg-yellow-500 text-white px-2 py-1 rounded text-xs hover:bg-yellow-600 flex items-center">
                <i class="fas fa-align-justify w-3 h-3 mr-1"></i> Format
            </button>
            <button id="clearButton" class="bg-red-500 text-white px-2 py-1 rounded text-xs hover:bg-red-600 flex items-center">
                <i class="fas fa-trash w-3 h-3 mr-1"></i> Clear
            </button>
            <button id="toggleView" class="text-blue-500 hover:text-blue-600 pl-8">
                <i class="fas fa-list w-4 h-4"></i>
            </button>
        </div>
    </div>
    <div class="relative flex-1 p-4 bg-gray-50 border border-gray-300 rounded text-xs overflow-auto">
    <!-- 复制按钮 -->
    <button id="copyButton" class="absolute top-2 right-2 bg-gray-200 bg-opacity-50 hover:bg-opacity-75 text-gray-700 px-2 py-1 rounded text-xs flex items-center">
        <i class="fas fa-copy mr-1"></i> Copy
    </button>

    <!-- 格式化后的SQL内容 -->
    <pre id="formattedQueryContent">Your formatted query will appear here...</pre>
</div>
</div>

    </div>

    <script>
    // DOM elements
    const sidebar = document.getElementById('sidebar');
    const toggleSidebarBtn = document.getElementById('toggleSidebar');
    const loginButton = document.getElementById('loginButton');
    const toggleViewBtn = document.getElementById('toggleView');
    const copyResultsBtn = document.getElementById('copyResults');
    const formatButton = document.getElementById('formatButton');
    const queryEditor = document.getElementById('queryEditor');
    const formattedQuery = document.getElementById('formattedQueryContent');

    // Toggle sidebar
    let sidebarOpen = false;
    toggleSidebarBtn.addEventListener('click', () => {
        sidebarOpen = !sidebarOpen;
        sidebar.style.width = sidebarOpen ? '12rem' : '0';
        toggleSidebarBtn.innerHTML = sidebarOpen
            ? '<i class="fas fa-chevron-left w-4 h-4"></i>'
            : '<i class="fas fa-chevron-right w-4 h-4"></i>';
    });

    // Toggle login/logout
    let isLoggedIn = false;
    loginButton.addEventListener('click', () => {
        isLoggedIn = !isLoggedIn;
        loginButton.innerHTML = isLoggedIn
            ? '<i class="fas fa-user w-3 h-3 mr-1"></i><span>Logout</span>'
            : '<i class="fas fa-user w-3 h-3 mr-1"></i><span>Login</span>';
    });

    // Format SQL query and display with syntax highlighting
    formatButton.addEventListener('click', () => {
        const query = queryEditor.value;
        if (query) {
            // 格式化 SQL 语句
            const formatted = window.sqlFormatter.format(query);

            // 使用 highlight.js 进行语法高亮
            formattedQuery.innerHTML = `<pre><code class="sql">${formatted}</code></pre>`;

            // 触发 highlight.js 高亮
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightElement(block);
            });
        } else {
            alert('Please enter a SQL query to format.');
        }
    });
	
	 // 复制功能
    document.getElementById("copyButton").addEventListener("click", function() {
        // 获取 formattedQuery 的内容
        const formattedQuery = document.getElementById("formattedQueryContent").innerText;
        
        // 创建临时textarea来复制内容
        const tempTextarea = document.createElement("textarea");
        tempTextarea.value = formattedQuery;
        document.body.appendChild(tempTextarea);
        tempTextarea.select();
        document.execCommand("copy");
        document.body.removeChild(tempTextarea);

        // 提示用户已复制
        alert("Query copied to clipboard!");
    });
</script>

</body>
</html>
